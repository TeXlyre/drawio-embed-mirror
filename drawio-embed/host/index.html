<!doctype html>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>drawio-embed</title>
<style>
  html, body { height: 100%; margin: 0; }
  iframe { width: 100%; height: 100%; border: 0; display: block; }
</style>
<iframe id="editor" allow="clipboard-read; clipboard-write"></iframe>
<script>
  const sp = new URLSearchParams(location.search);
  const theme = sp.get('theme') || 'light';
  const ui = theme === 'dark' ? 'dark' : 'kennedy';

  const params = new URLSearchParams({
    embed: '1',
    proto: 'json',
    spin: '1',
    libraries: '1',
    saveAndExit: '0',
    noSaveBtn: '1',
    noExitBtn: '1',
    db: '0',
    od: '0',
    gapi: '0',
    tr: '0',
    gh: '0',
    gl: '0',
    stealth: '1',
    offline: '1',
    ui
  });

  const iframe = document.getElementById('editor');
  iframe.src = `../${theme}/app.html?${params.toString()}`;

  function post(action, extra = {}) {
    iframe.contentWindow.postMessage(JSON.stringify({ action, ...extra }), '*');
  }

  function blankMxfile() {
    return '<mxfile host="app.diagrams.net"><diagram name="Page-1"></diagram></mxfile>';
  }

  window.addEventListener('message', (evt) => {
    let msg;
    try { msg = JSON.parse(evt.data); } catch { return; }
    if (!msg || typeof msg !== 'object') return;
    if (msg.event === 'init') {
      post('load', { xml: blankMxfile() });
    }
  });
</script>
